<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Wood Street - Bring The Good Cart To Life.</title>
    <meta name="keywords" content="HTML5 Template" />
    <meta name="description" content=" - Bootstrap " />
    <meta name="author" content="p-themes" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assets/images/icons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/images/icons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assets/images/icons/favicon-16x16.png"
    />
    <link rel="manifest" href="assets/images/icons/site.html" />
    <link
      rel="mask-icon"
      href="assets/images/icons/safari-pinned-tab.svg"
      color="#666666"
    />
    <link rel="shortcut icon" href="assets/images/icons/favicon.ico" />
    <meta name="apple-mobile-web-app-title" content="spy" />
    <meta name="application-name" content="spy" />
    <meta name="msapplication-TileColor" content="#cc9966" />
    <meta
      name="msapplication-config"
      content="assets/images/icons/browserconfig.xml"
    />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="assets/css/plugins/owl-carousel/owl.carousel.css"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <link href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.datatables.net/v/bs5/jq-3.6.0/dt-1.13.4/sp-2.1.2/datatables.min.css" rel="stylesheet"/>
    <style>      
      .dataTables_wrapper .sorting:after,
      .dataTables_wrapper .sorting_asc:after,
      .dataTables_wrapper .sorting_desc:after {
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        font-size: 12px;
        display: inline-block;
        margin-left: 5px;
        content: "\f0dc";
      }
    .dataTables_wrapper .sorting_asc:after {
      content: "\f0de";
    }
    .dataTables_wrapper .sorting_desc:after {
      content: "\f0dd";
    }
  </style>
  </head>

  <body>
    <div class="page-wrapper">
      <header class="header">
        <div class="header-top">
          <div class="container">
            <div class="header-left">
              <div class="header-dropdown">
               
              </div>

              <div class="header-dropdown">
                
              </div>
            </div>

            <div class="header-right">
              <div class="header-dropdown">
                <a href="#"><i class="icon-user"></i>My Account</a>
                <div class="header-menu">
                  <ul>
                    <li><a href="#">Settings</a></li>
                    <li><a href="/admin/logout">Logout</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="header-middle sticky-header">
          <div class="container">
            <div class="header-left">
              <button class="mobile-menu-toggler">
                <span class="sr-only">Toggle mobile menu</span>
                <i class="icon-bars"></i>
              </button>

              <a href="/admin" class="logo">
                <img src="assets/images/logo.png" alt="Wood Street Logo" width="105" height="25">
            </a>

              <nav class="main-nav">
                <ul class="menu sf-arrows">
                  <li class="megamenu-container">
                    <a href="/admin/">Home</a>
                  </li>
                  <li>
                    <a href="/admin/categorylist" class="sf-with-ul">Categories</a>
                    <ul>
                      <li><a href="/admin/categorylist">Category Lists</a></li>
                      <li><a href="/admin/addcategory">Add New Category</a></li>
                    </ul>
                  </li>
                  <li>
                    <a href="/admin/productslist" class="sf-with-ul">Products</a>
                    <ul>
                      <li>
                        <a href="/admin/productslist">Product Lists</a>
                      </li>
                      <li>
                        <a href="/admin/addproduct">Add New Product</a>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <a href="/admin/couponslist" class="sf-with-ul">Coupons</a>
                    <ul>
                      <li>
                        <a href="/admin/couponslist">Coupon Lists</a>
                      </li>
                      <li>
                        <a href="/admin/addcoupon">Add New Coupon</a>
                      </li>
                    </ul>
                  </li>
                  <li><a href="/admin/userslist">Users</a></li>
                  <li><a href="/admin/orderslist">Orders</a></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </header>

      <main class="main">
        <div class="container">
          <div class="table-responsive" id="no-more-tables">
            <table class="table table-striped bg-white" id="myTable">
              <thead class="bg-dark text-light">
                <tr>
                  <th style="font-size: 20px;" scope="col" class="sorting" data-sort="name">Coupon Name</th>
                  <th style="font-size: 20px;" scope="col">Discount</th>  
                  <th style="font-size: 20px;" scope="col">Min Purchase Amount</th>  
                  <th style="font-size: 20px;" scope="col">Limit</th>
                  <th style="font-size: 20px;" scope="col">Expiry Date</th>
                  <th style="font-size: 20px;" scope="col">Status</th>
                </tr>
              </thead>
              <tbody> 
                <% if (typeof coupons !="undefined") { %>
                    <% for(let i = 0; i < coupons.length; i++) { %>
                      <tr style="font-size: medium;">
                        <td data-title="Name"><%= coupons[i].couponName %></td>   
                        <td data-title="Name"><%= coupons[i].discount %></td> 
                        <td data-title="Name"><%= coupons[i].minimumPurchase %></td> 
                        <td data-title="Name"><%= coupons[i].limit %></td> 
                        <td data-title="Name">
                          <% 
                            var date = new Date(coupons[i].expiryDate);
                            var day = date.getDate();
                            var month = date.toLocaleString('default', { month: 'short' });
                            var year = date.getFullYear();
                          %>
                          <%= day + ' ' + month + ' ' + year %>
                        </td> 
                        <td data-title="Actions">                          
                          <% if (coupons[i].isActive == false) { %>
                              <button id="unblock-btn-<%= coupons[i]._id %>" type="button" class="btn" style="border-radius: 5px; background-color: rgb(25, 135, 84);" onclick="unblockCoupon('<%= coupons[i]._id %>')">Unblock</button>
                              <button id="block-btn-<%= coupons[i]._id %>" type="button" class="btn" style="border-radius: 5px; background-color: rgb(220,53,69);" onclick="blockCoupon('<%= coupons[i]._id %>')" disabled>Block</button>
                          <% } else { %>
                              <button id="unblock-btn-<%= coupons[i]._id %>" type="button" class="btn" style="border-radius: 5px; background-color: rgb(25, 135, 84);" onclick="unblockCoupon('<%= coupons[i]._id %>')" disabled>Unblock</button>
                              <button id="block-btn-<%= coupons[i]._id %>" type="button" class="btn" style="border-radius: 5px; background-color: rgb(220,53,69);" onclick="blockCoupon('<%= coupons[i]._id %>')">Block</button>
                          <% } %>                          
                      </td>
                      
                      </tr>
                    <% } %>
                  <% } else { %>
                    <tr>
                      <td colspan="6" class="text-center">No coupons found.</td>
                    </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    
    
    
    
    <script>
      function unblockCoupon(couponId){

        

        fetch('/admin/unblockcoupon',{
          method:'POST',
          headers:{
            'Content-Type':'application/json'
          },
          body:JSON.stringify({couponId})
        }).then(response => response.json())
        .then(data=>{
          if(data.success){
            const unblockButton = document.getElementById(`unblock-btn-${couponId}`);
             const blockButton = document.getElementById(`block-btn-${couponId}`);
      
             unblockButton.disabled = true;
            blockButton.disabled = false;
    
    
    
    }else{
            alert(data.error)
          }
        })
      
      }

      function blockCoupon(couponId){

        
        fetch('/admin/blockcoupon',{
          method:'POST',
          headers:{
            'Content-Type':'application/json'
          },
          body:JSON.stringify({couponId})
        }).then(response => response.json())
        .then(data=>{
          if(data.success){
            const blockButton = document.getElementById(`block-btn-${couponId}`);
            const unblockButton = document.getElementById(`unblock-btn-${couponId}`);

            blockButton.disabled = true;
            unblockButton.disabled = false;
    
    }else{
            alert(data.error)
          }        })
      }





      $(document).ready(function() {
        $('#myTable').DataTable();
      });
    </script>
  </body>
</html>
